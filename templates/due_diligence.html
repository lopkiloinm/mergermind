{% extends 'layout.html' %}
{% block content %}
<h2>Due Diligence</h2>
<p>
 The Due Diligence process allows you to evaluate the financial and operational health of a company. By uploading documents such as financial statements or legal contracts, you can analyze the key aspects that are important in assessing potential risks and benefits before making investment decisions or forming business partnerships.
</p>
<p>
 Please ensure the document is in PDF format and structured in a way that highlights the company's financial stability, legal compliance, and operational efficiency.
</p>

<div style="text-align: center; margin-top: 30px;">
    <form method="post" enctype="multipart/form-data" id="upload-form" style="display: inline-block;">
        <div style="border: 2px dotted #007bff; padding: 40px; width: 300px; max-width: 100%; margin-bottom: 20px;">
            <button type="button" id="upload-button" style="background-color: #007bff; color: white; border: none; padding: 15px 30px; cursor: pointer; font-size: 16px; width: 100%;" onclick="document.getElementById('file-input').click();">Select File to Upload</button>
            <input type="file" name="file" accept="application/pdf" id="file-input" style="display: none;" required onchange="handleFileSelect();">
        </div>
        <p style="margin: 0; font-size: 14px; color: #555;">or drag & drop</p>
    </form>
</div>

<!-- Status updates section -->
<div id="status" style="text-align: center; margin-top: 20px;"></div>

<!-- Notes about Heroku's timeout -->
<p style="text-align: center; font-size: 14px; color: #555; max-width: 500px; margin: 20px auto;">
 Note: Heroku imposes a 30-second request timeout. For larger documents, consider splitting them into smaller parts to avoid timeout errors.
</p>

<div style="text-align: center;">
    <a href="{{ url_for('download_example_file') }}"
       style="background-color: #28a745; color: white; border: none; padding: 15px 30px; cursor: pointer; font-size: 16px; text-decoration: none; display: inline-block; margin-top: 10px;">
       Download Example File
    </a>
</div>

<script>
function handleFileSelect() {
    // Get the upload button and file input elements
    var uploadButton = document.getElementById('upload-button');
    var fileInput = document.getElementById('file-input');

    // Disable the button and change its style
    uploadButton.disabled = true;
    uploadButton.style.backgroundColor = '#ccc'; // Light gray color to indicate disabled state
    uploadButton.style.cursor = 'not-allowed'; // Change the cursor to indicate it's not clickable

    // Submit the form
    document.getElementById('upload-form').submit();
}

function updateStatus() {
    fetch('/get_processing_status') // Endpoint to get the session status
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log("Received status data:", data); // Log fetched data for debugging
            const statusElement = document.getElementById('status');
            statusElement.innerHTML = ''; // Clear previous status
            if (data.status.length === 0) {
                statusElement.innerHTML = 'No status updates available.';
            } else {
                data.status.forEach(item => {
                    statusElement.innerHTML += `<p>${item}</p>`;
                });
            }
        })
        .catch(error => {
            console.error('Error fetching status:', error);
            const statusElement = document.getElementById('status');
            statusElement.innerHTML = 'Error fetching status updates.';
        });
}

setInterval(updateStatus, 2000); // Poll every 2 seconds
</script>
{% endblock %}